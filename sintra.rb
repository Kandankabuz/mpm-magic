#!/usr/bin/env ruby

require 'rubygems'
require 'sinatra'
require 'sinatra/reloader' if development?
require_relative 'creature'
require_relative 'fight'
require_relative 'player'
require_relative 'world'
require_relative 'battle'
require_relative 'turn'
require_relative 'phase'
require_relative 'deck'

set :bind, '0.0.0.0'

set :views, Proc.new { File.join(root, "views") }

helpers do
  def h(text)
    Rack::Utils.escape_html(text)
  end
end

mat   = Player.new( name:"Mathieu")
olive = Player.new( name:"Olivier", health:16)


@@world = World.new(mat,olive)


gob = Creature.gob
elf = Creature.elf
angel = Creature.new( name: "Angel" , strength: 5 , toughness: 5 , img:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAFoAcQMBIgACEQEDEQH/xAAcAAACAgMBAQAAAAAAAAAAAAAEBQIGAQMHAAj/xAA2EAABBAECAwcCBAQHAAAAAAABAAIDEQQFIRIxUQYTIkFhcYEyoQcUQpEjNMHwFyQzcoKx0f/EABkBAQEBAQEBAAAAAAAAAAAAAAMEAgEFAP/EACIRAAMAAgIBBAMAAAAAAAAAAAABAgMREiExFCJBUQQTYf/aAAwDAQACEQMRAD8ASxQ20JnhR8NhDQs4W0UfigBeDDPctaQ1w28k3gb4gleL9QTiAclQiC/I0wmg0m+MKd8pXgEJrB9WyWUS0xq3kFlYb9IWV6C8GCMgttJJqEdsKeO5JTnjwlDk8nUU3UY+Y9UqkZ4aTzPADnX1SaV252QjSAPjHRDPj3R0h9EM+rQZKRVjlmjgC8p7ryn5lHEGYEVAapDNCJhCGKGyLob4wDuH9J8r809xWihfNJ4Wsmw3b08DoteH2nj01wx9TYZILrvbtzf79VTL2QXP0XHEYQRtsU3xWjiSfSMnBz2cem5kWQ0blrXeNvu3mE6xnDjpVr+kdLsOHJZUQVkqxPoMjIaaUozX0xyYzyAChuqtr2q4Wntc7OzGQgcox45D/wARy+aUt1tiTOxZqbxxO90nyuHFHFkOHGd2wg7+7untzSfWO3kpD49JxY8cO27+Xxyn28m/F+6T4uXNKO8mlcXONvf5kqfJfXRbix/ZYpZuIi9jzrlSHmdW6AZMAdtmqb8lhH1KdvopS7N3erKD74ei8sG+Jsx5uNxb+ncttHwgmg0WSf2CW4jblYRyN1SbROHCXjz5eyL5N14C2vMUVg7lK9Txhmxuqg/r1RT3mkHJIWlPDJaRXZfzGmyB/iY5n0yNJBarVov4mZunsa3UP84wfqk+uv8AcOfyhHGLJbwTtDglGq9nX926bA/iefdAKib0A5TO19le2Wl9pWu/JOeyVgt0Ugo/CsL5QAvmXs/rUug6tj5bHFj4pAJWVzZfibXsuz5fbXSMfKysV+UzjxIGzvJPhc0gkAHzND7hVTTaJbjTK1+IfbfIh1B+laXM6MRf672eZ6WuaT5Msj3cJL5Hna990BJkZOfM6R/E+eVxfIAObibJ+6f6ZpTMaLjyRxPdvR8vugt6ZTjXQPg4lDimLeLzBO4RfeRxE00BacrIcCUvknJPNE02UrobnLHVBsySJNzsgjNy35qBnYHBpuyvuAiob/mPVeSv8w31Xlzgd5Bw1bvcrDbEwthjI8INkkit+vNOmZ/E2MMNta7xOB50qJFKWeJzqA/7TPEy5Gs4GP8ACRY+V3Jh66MTk35L+yVkzCY3B29WOSFnYUn0/OLbDXVYATQTiRh4zR6BAk5Z9RqafEAPlNMKQtlaeiVtd/E5UEwxXtLzR5CkjoLie1PRcDVYzLkxubKGmpY3U7/w/IXKoe8y8yg5xYHDjJO/BxBv9QutZTnSY74IyRbLe9v6W+nqdwOnPoDzDQ8WWTVI2uAa1xtxrag4E/cUqsFe17J8s9rR0SDRtO0xnFjREuPN0juIpdmP8ZTnMdQA9Uk1ADiJBUjvdFMxpCTLNuKAfsSjMuRoJs8uaXCXvASRSee0dekTD9qQ2TJRLr9lgzXYCEyH8QpLM9mKro2d+eqygt15NwQfJmMmcvHAPp5n3TTTci42Gh4RVH0SV31H3RmGyQuMRNRjntztauVxMxT5bLBh5bJXERvvh6JtDkyGYFx2rlfJVjBxRjP7zjc4+QGw+U/w3OlFAb+9KHLMp7RTHKvIwinPeni5E7bptiynh8NXW1pWzT5y4FvCTe26c4GlZ764MeR19FJdz9jKNeQwAR4tN3JNl3mT1VV03TzBrJDW+ANJZ6AuFj910OPs5qJgs476rlW6hh9mMoZPGcaS+VlhH9FictJP+mX+v7EOYDzKrerZXdvDSxxB2Jr+/VdH1Ls3mFhLYnD14SqZrOg57GFojG/na5iyLl7jfTXtZTZd5Hd5Zs2aNIIuDbTLOxciK2uZRveqSiZkjSS5pC9PHpk1ppkXGgd0M40LKm5xQ83iaRdKiUBTJd83qP3WEGvJuCB/YzYTbrRWPkcMYBPJBhZC+aTR2aaexkM0jkSiYtVkjqnmh6pKvBG8UsRZaLXjdop2HaT7prj9ssyKi2dwI87VCHktlnqUF/iY38DL8m0dH/xC1MD+af8AuoP/ABE1S9sl99bXO7PUrFnqVj0WL6PvU0dAk/EPWHD+dl+HJdmds9WyRUmoZBB8u8Kp5J6qJJ6rS/ExL4Oeooc5Ws5Etl873E9XWl0mYXnclCFYVE4pnwFWWmbnTErU5xJ5qKwkSQTpslY6LKgvLpnZ/9k="  )
wall = Creature.new( name: "Wall" , strength: 0 , toughness: 7 , img: "data:image/jpeg;base64,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")

mat.summon! gob
mat.summon! angel
olive.summon! elf
olive.summon! wall

5.times do
  mat.deck << Creature.gob
end

mat.deck << Creature.elf
get "/" do
  erb :home
end

get "/next" do
  @@world.turn.next!
  redirect "/"
end

get "/end" do
  @@world.turn.end!
  redirect "/"
end
